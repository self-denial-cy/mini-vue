<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>index</title>
  <style>
    .flex {
      display: flex;
    }

    .mr16 {
      margin-right: 16px;
    }
  </style>
</head>

<body>
  <div id="app">
    <h3>根模块：</h3>
    <h4>{{$store.state.count}}</h4>
    <h4>{{$store.getters.myCount}}</h4>
    <h4>{{$store.getters.myCount}}</h4>
    <h4>{{$store.getters.myCount}}</h4>
    <h4>{{$store.getters.myCount}}</h4>
    <h3>a模块：</h3>
    <h4>{{$store.state.a.count}}</h4>
    <h3>b模块：</h3>
    <h4>{{$store.state.a.b.count}}</h4>
    <h3>c模块：</h3>
    <h4>{{$store.state.c.count}}</h4>
    <div class="flex">
      <button class="mr16" @click="$store.commit('add', 2)">触发Mutation</button>
      <button class="mr16" @click="$store.dispatch('add', 3)">触发Action</button>
    </div>
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
<script src="./dist/vuex.js"></script>

<script>
  Vue.use(Vuex);

  const store = new Vuex.Store({
    state: {
      count: 888,
      text: ''
    },
    mutations: {
      add(state, payload) {
        state.count += payload;
      }
    },
    actions: {
      add({ commit }, payload) {
        setTimeout(() => {
          commit('add', payload);
        }, 1500);
      }
    },
    getters: {
      myCount(state) {
        // 内部使用了计算属性，依赖不变的话只会执行一次计算
        console.log('runner');
        return state.count + 1;
      }
    },
    modules: {
      a: {
        namespaced: true,
        state: {
          count: 777
        },
        mutations: {
          add(state, payload) {
            state.count += payload;
          }
        },
        modules: {
          b: {
            namespaced: true,
            state: {
              count: 555
            },
            mutations: {
              add(state, payload) {
                state.count += payload;
              }
            }
          }
        }
      },
      c: {
        state: {
          count: 666
        },
        mutations: {
          add(state, payload) {
            state.count += payload;
          }
        }
      }
    }
  });

  const vm = new Vue({
    store,
    el: '#app'
  });
</script>

</html>